

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>A simple example &mdash; Py-Staff 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Quick Introduction" href="readme.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Py-Staff
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="readme.html">Quick Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">A simple example</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#packages">Packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-in-our-data">Load in our data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#mask-out-any-sections-we-want-to-ignore">Mask out any sections we want to ignore</a></li>
<li class="toctree-l2"><a class="reference internal" href="#select-the-regions-we-want-to-fit-between">Select the regions we want to fit between</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-the-class">Load the class</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Py-Staff</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>A simple example</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/Example.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="a-simple-example">
<h1>A simple example<a class="headerlink" href="#a-simple-example" title="Permalink to this headline">¶</a></h1>
<p>This example is contained in <code class="docutils literal"><span class="pre">fit_example.py</span></code></p>
<div class="section" id="packages">
<h2>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h2>
<p>You’ll need the following packages to run this simple example, most of which should come as standard in the scientific python library.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">numpy</span></code>, <code class="docutils literal"><span class="pre">scipy</span></code> and <code class="docutils literal"><span class="pre">matplotlib</span></code></li>
<li><code class="docutils literal"><span class="pre">lmfit</span></code> for its <code class="docutils literal"><span class="pre">Parameters</span></code> object</li>
<li>A fitting code- we’ll use <code class="docutils literal"><span class="pre">emcee</span></code></li>
</ul>
</div>
<div class="section" id="load-in-our-data">
<h2>Load in our data<a class="headerlink" href="#load-in-our-data" title="Permalink to this headline">¶</a></h2>
<p>We first read the datafile and get the relevant wavelength array, flux spectrum and error spectrum. TODO: Include a datafile with this example</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">M_datafile</span><span class="o">=</span><span class="s1">&#39;/path/to/spectrum.fits&#39;</span>

<span class="n">M_data</span><span class="o">=</span><span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">M_datafile</span><span class="p">))</span>
<span class="n">M_header</span><span class="o">=</span><span class="n">M_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">header</span>

<span class="n">M_WCS</span><span class="o">=</span><span class="n">WCS</span><span class="p">(</span><span class="n">M_header</span><span class="p">)</span>

<span class="n">lambdas</span><span class="o">=</span><span class="n">M_WCS</span><span class="o">.</span><span class="n">wcs_pix2world</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">M_header</span><span class="p">[</span><span class="s1">&#39;NAXIS1&#39;</span><span class="p">])[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="mi">10</span><span class="p">)</span> <span class="c1">#In angstroms</span>

<span class="n">flux</span><span class="o">=</span><span class="n">M_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">errors</span><span class="o">=</span><span class="n">M_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
</pre></div>
</div>
<p>You can optionally load a number of sky spectra here, and an array of values for the instrumental resolution as a function of wavelength.</p>
</div>
<div class="section" id="mask-out-any-sections-we-want-to-ignore">
<h2>Mask out any sections we want to ignore<a class="headerlink" href="#mask-out-any-sections-we-want-to-ignore" title="Permalink to this headline">¶</a></h2>
<p>We can give a list of two-component arrays with ‘start’ and ‘stop’ wavelengths around regions of the spectrum we don’t want to fit. These might be areas of residual telluric absorption, particularly bad sky-lines, etc. These should be <em>observed</em> wavelengths, so can be read straight from the spectrum.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">telluric_lam_1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">6862</span><span class="p">,</span> <span class="mi">6952</span><span class="p">]])</span>
<span class="n">telluric_lam_2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">7586</span><span class="p">,</span> <span class="mi">7694</span><span class="p">]])</span>
<span class="n">skylines</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">8819</span><span class="p">,</span> <span class="mi">8834</span><span class="p">],</span> <span class="p">[</span><span class="mf">8878.0</span><span class="p">,</span> <span class="mi">8893</span><span class="p">],</span> <span class="p">[</span><span class="mi">8911</span><span class="p">,</span> <span class="mi">8925</span><span class="p">],</span> <span class="p">[</span><span class="mi">8948</span><span class="p">,</span> <span class="mi">8961</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="section" id="select-the-regions-we-want-to-fit-between">
<h2>Select the regions we want to fit between<a class="headerlink" href="#select-the-regions-we-want-to-fit-between" title="Permalink to this headline">¶</a></h2>
<p>During the fit, we have to compare the model and our data and use multiplicative Legendre polynomials to correct for small differences in continuum shape caused by the instrument or poor flux calibration. Ideally we’d fit the entire spectrum at once, but this tends to make finding these polynomials too slow. Here, we compromise by splitting our spectrum into four sections, with each one getting its own set of polynomials. These are then combined in the likelihood function.</p>
<p>These wavelength are <em>rest frame</em> wavelengths. They’ll be the values which we plot on the x-axis at the end.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fit_wavelengths</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">4600</span><span class="p">,</span> <span class="mi">5600</span><span class="p">],</span> <span class="p">[</span><span class="mi">5600</span><span class="p">,</span> <span class="mi">6800</span><span class="p">],</span> <span class="p">[</span><span class="mi">6800</span><span class="p">,</span> <span class="mi">8000</span><span class="p">],</span> <span class="p">[</span><span class="mi">8000</span><span class="p">,</span>  <span class="mi">9000</span><span class="p">],</span> <span class="p">[</span><span class="mi">9700</span><span class="p">,</span> <span class="mi">10500</span><span class="p">]])</span>
</pre></div>
</div>
<p>TODO: Sort out what FWML_gal is</p>
</div>
<div class="section" id="load-the-class">
<h2>Load the class<a class="headerlink" href="#load-the-class" title="Permalink to this headline">¶</a></h2>
<p>We can now load our SpectralFit class:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">fit</span><span class="o">=</span><span class="n">SpectralFit</span><span class="p">(</span><span class="n">lamdas</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">errors</span><span class="p">,</span> <span class="n">pixel_weights</span><span class="p">,</span> <span class="n">fit_wavelengths</span><span class="p">,</span> <span class="n">FWHM_gal</span><span class="p">,</span> <span class="n">instrumental_resolution</span><span class="o">=</span><span class="n">instrumental_resolution</span><span class="p">,</span> <span class="n">skyspecs</span><span class="o">=</span><span class="n">skyspecs</span><span class="p">,</span> <span class="n">element_imf</span><span class="o">=</span><span class="n">element_imf</span><span class="p">)</span>
<span class="n">fit</span><span class="o">.</span><span class="n">set_up_fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="readme.html" class="btn btn-neutral" title="Quick Introduction" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Sam Vaughan.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>